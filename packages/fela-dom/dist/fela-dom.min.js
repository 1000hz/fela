!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.FelaDOM=t()}(this,function(){"use strict";function e(e){return e.replace(/([a-z]|^)([A-Z])/g,function(e,t,n){return t+"-"+n.toLowerCase()}).replace("ms-","-ms-")}function t(t){return Object.keys(t).reduce(function(n,r){return n.length>0&&(n+=";"),n+=e(r)+":"+t[r]},"")}function n(e){var t=0,n=0,r=void 0,o=e.length;if(0===o)return"s";for(;o>n;++n)r=e.charCodeAt(n),t=(t<<5)-t+r,t|=0;return t.toString(36)}function r(e){return void 0===e?"":Object.keys(e).sort().reduce(function(t,n){return t+=n+e[n]},"")}var o={};o["typeof"]="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o.createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o["extends"]=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o.inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},o.possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t};var s=function(){function e(){o.classCallCheck(this,e),this.listeners=new Set,this._init()}return o.createClass(e,[{key:"clear",value:function(){this._init()}},{key:"renderToString",value:function(){var e=this,t=this._renderCache(this.cache);return this.mediaCache.forEach(function(n,r){t+=e._renderMediaQuery(r,e._renderCache(n))}),t}},{key:"subscribe",value:function(e){var t=this;return this.listeners.add(e),{unsubscribe:function(){return t.listeners["delete"](e)}}}},{key:"_emitChange",value:function(){var e=this.renderToString();this.listeners.forEach(function(t){return t(e)})}},{key:"_init",value:function(){this.cache=new Map,this.mediaCache=new Map,this.ids=new Map,this._counter=-1}},{key:"_renderSelectorVariation",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=arguments.length<=2||void 0===arguments[2]?[]:arguments[2],o=e instanceof Function,s=!o&&e.renderMedia instanceof Function;this.cache.has(e)||(this.ids.set(e,++this._counter),this.cache.set(e,new Map),s&&e.mediaStrings.forEach(function(n){t.mediaCache.has(n)||t.mediaCache.set(n,new Map),t.mediaCache.get(n).set(e,new Map)}));var i=this.cache.get(e),a=this._generatePropsReference(n),c=this._renderClassName(this.ids.get(e),a);return i.has(a)||!function(){var u={plugins:r,processStyles:t._processStyles,styles:o?e(n):e.render(n),className:c,props:n};i.set(a,t._processStyles(u)),s&&e.mediaStrings.forEach(function(r){u.styles=e.renderMedia(n,r),u.media=r;var o=t._processStyles(u);t.mediaCache.get(r).get(e).set(a,o)}),t._emitChange()}(),c}},{key:"_processStyles",value:function(e){var t=e.plugins,n=e.styles;return t.forEach(function(t){return t(e)}),n}},{key:"_generatePropsReference",value:function(e){return n(r(e))}},{key:"_renderClassName",value:function(e,t){return"c"+e+"-"+t}},{key:"_splitPseudoClasses",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?"":arguments[1],r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return Object.keys(e).forEach(function(o){var s=e[o];s instanceof Object?t._splitPseudoClasses(s,n+o,r):(r[n]||(r[n]={}),r[n][o]=s)}),r}},{key:"_renderSelector",value:function(e,n){return"."+e+"{"+t(n)+"}"}},{key:"_renderMediaQuery",value:function(e,t){return"@media("+e+"){"+t+"}"}},{key:"_renderCache",value:function(e){var t=this,n="";return e.forEach(function(e,r){var o=t.ids.get(r);e.forEach(function(e,r){var s=t._renderClassName(o,r),i=t._splitPseudoClasses(e);Object.keys(i).forEach(function(e){n+=t._renderSelector(s+e,i[e])})})}),n}}]),e}(),i=1,a="STYLE",c=function(){function e(t){var n=this;return o.classCallCheck(this,e),t.nodeType!==i||void 0===t.textContent?(console.error("You need to specify a valid element node (nodeType = 1) to render into."),!1):(t.nodeName!==a&&console.warn("You are using a node other than `<style>`. Your styles might not get applied correctly."),t.hasAttribute("data-fela-stylesheet")&&console.warn("This node is already used by another renderer. Rendering might overwrite other styles."),t.setAttribute("data-fela-stylesheet",""),this.node=t,this.stylesheet=new s,void this.stylesheet.subscribe(function(e){return n.node.textContent=e}))}return o.createClass(e,[{key:"render",value:function(e,t,n){return this.stylesheet._renderSelectorVariation(e,t,n)}},{key:"clear",value:function(){this.stylesheet.clear(),this.node.textContent=""}}]),e}(),u=function(){function e(t){o.classCallCheck(this,e),this.composer=t}return o.createClass(e,[{key:"render",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this.composer(e)}}]),e}(),l=function(e){function t(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];o.classCallCheck(this,t);var r=o.possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));return r.mediaComposer=n,r.mediaStrings=Object.keys(n),0===Object.keys(n).length&&console.warn("You are using a MediaSelector without specifying at least one media style composer. Prefer using basic Selectors instead."),r}return o.inherits(t,e),o.createClass(t,[{key:"renderMedia",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=arguments[1],n=this.mediaComposer[t];return n(e)}}]),t}(u),f={Renderer:c,MediaSelector:l};return f});