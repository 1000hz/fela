!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.FelaDOM=t()}(this,function(){"use strict";function e(e){return e.replace(/([a-z]|^)([A-Z])/g,function(e,t,n){return t+"-"+n.toLowerCase()}).replace("ms-","-ms-")}function t(t){return Object.keys(t).reduce(function(n,r){return n.length>0&&(n+=";"),n+=e(r)+":"+t[r]},"")}function n(e){var t=0,n=0,r=void 0,i=e.length;if(0===i)return"s";for(;i>n;++n)r=e.charCodeAt(n),t=(t<<5)-t+r,t|=0;return t.toString(36)}function r(e){return void 0===e?"":Object.keys(e).sort().reduce(function(t,n){return t+=n+e[n]},"")}var i={};i.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i.createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var a=function(){function e(){i.classCallCheck(this,e),this.listeners=new Set,this._init()}return i.createClass(e,[{key:"clear",value:function(){this._init()}},{key:"renderToString",value:function(){var e=this,t=this._renderCache(this.cache);return this.mediaCache.forEach(function(n,r){t+=e._renderMediaQuery(r,e._renderCache(n))}),t}},{key:"subscribe",value:function(e){var t=this;return this.listeners.add(e),{unsubscribe:function(){return t.listeners["delete"](e)}}}},{key:"_emitChange",value:function(){var e=this.renderToString();this.listeners.forEach(function(t){return t(e)})}},{key:"_init",value:function(){this.cache=new Map,this.mediaCache=new Map,this.ids=new Map,this._counter=-1}},{key:"_renderSelectorVariation",value:function(e,t,n){var r=this;this.cache.has(e)||(this.ids.set(e,++this._counter),this.cache.set(e,new Map),e.mediaStrings.forEach(function(t){r.mediaCache.has(t)||r.mediaCache.set(t,new Map),r.mediaCache.get(t).set(e,new Map)}));var i=this.cache.get(e),a=this._generatePropsReference(t);if(!i.has(a)){var s=e.render(t,n),o=s.styles,c=s.mediaStyles;i.set(a,o),c.forEach(function(t,n){r.mediaCache.get(n).get(e).set(a,t)}),this._emitChange()}return this._renderClassName(this.ids.get(e),a)}},{key:"_generatePropsReference",value:function(e){return n(r(e))}},{key:"_renderClassName",value:function(e,t){return"c"+e+"-"+t}},{key:"_renderSelector",value:function(e,n){return"."+e+"{"+t(n)+"}"}},{key:"_renderMediaQuery",value:function(e,t){return"@media("+e+"){"+t+"}"}},{key:"_renderCache",value:function(e){var t=this,n="";return e.forEach(function(e,r){var i=t.ids.get(r);e.forEach(function(e,r){var a=t._renderClassName(i,r);n+=t._renderSelector(a,e)})}),n}}]),e}(),s=1,o="STYLE",c=function(){function e(t){var n=this;return i.classCallCheck(this,e),t.nodeType!==s||void 0===t.textContent?(console.error("You need to specify a valid element node (nodeType = 1) to render into."),!1):(t.nodeName!==o&&console.warn("You are using a node other than `<style>`. Your styles might not get applied correctly."),t.hasAttribute("data-fela-stylesheet")&&console.warn("This node is already used by another renderer. Rendering might overwrite other styles."),t.setAttribute("data-fela-stylesheet",""),this.node=t,this.stylesheet=new a,void this.stylesheet.subscribe(function(e){return n.node.textContent=e}))}return i.createClass(e,[{key:"render",value:function(e,t,n){return this.stylesheet._renderSelectorVariation(e,t,n)}},{key:"clear",value:function(){this.stylesheet.clear(),this.node.textContent=""}}]),e}(),u={Renderer:c};return u});