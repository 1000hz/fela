!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.FelaDOMServer=t()}(this,function(){"use strict";function e(e){return e.replace(/([a-z]|^)([A-Z])/g,function(e,t,n){return t+"-"+n.toLowerCase()}).replace("ms-","-ms-")}function t(t){return Object.keys(t).reduce(function(n,r){return n.length>0&&(n+=";"),n+=e(r)+":"+t[r]},"")}function n(e){var t=0,n=0,r=void 0,i=e.length;if(0===i)return"s";for(;i>n;++n)r=e.charCodeAt(n),t=(t<<5)-t+r,t|=0;return t.toString(36)}function r(e){return void 0===e?"":Object.keys(e).sort().reduce(function(t,n){return t+=n+e[n]},"")}var i={};i["typeof"]="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},i.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i.createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i["extends"]=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};var s=function(){function e(){i.classCallCheck(this,e),this.listeners=new Set,this._init()}return i.createClass(e,[{key:"clear",value:function(){this._init()}},{key:"renderToString",value:function(){var e=this,t=this._renderCache(this.cache);return this.mediaCache.forEach(function(n,r){t+=e._renderMediaQuery(r,e._renderCache(n))}),t}},{key:"subscribe",value:function(e){var t=this;return this.listeners.add(e),{unsubscribe:function(){return t.listeners["delete"](e)}}}},{key:"_emitChange",value:function(){var e=this.renderToString();this.listeners.forEach(function(t){return t(e)})}},{key:"_init",value:function(){this.cache=new Map,this.mediaCache=new Map,this.ids=new Map,this._counter=-1}},{key:"_renderSelectorVariation",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=arguments.length<=2||void 0===arguments[2]?[]:arguments[2],i=e instanceof Function,s=!i&&e.renderMedia instanceof Function;this.cache.has(e)||(this.ids.set(e,++this._counter),this.cache.set(e,new Map),s&&e.mediaStrings.forEach(function(n){t.mediaCache.has(n)||t.mediaCache.set(n,new Map),t.mediaCache.get(n).set(e,new Map)}));var a=this.cache.get(e),o=this._generatePropsReference(n),c=this._renderClassName(this.ids.get(e),o);return a.has(o)||!function(){var u={plugins:r,processStyles:t._processStyles,styles:i?e(n):e.render(n),className:c,props:n};a.set(o,t._processStyles(u)),s&&e.mediaStrings.forEach(function(r){u.styles=e.renderMedia(n,r),u.media=r;var i=t._processStyles(u);t.mediaCache.get(r).get(e).set(o,i)}),t._emitChange()}(),c}},{key:"_processStyles",value:function(e){var t=e.plugins,n=e.styles;return t.forEach(function(t){return t(e)}),n}},{key:"_generatePropsReference",value:function(e){return n(r(e))}},{key:"_renderClassName",value:function(e,t){return"c"+e+"-"+t}},{key:"_splitPseudoClasses",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?"":arguments[1],r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return Object.keys(e).forEach(function(i){var s=e[i];s instanceof Object?t._splitPseudoClasses(s,n+i,r):(r[n]||(r[n]={}),r[n][i]=s)}),r}},{key:"_renderSelector",value:function(e,n){return"."+e+"{"+t(n)+"}"}},{key:"_renderMediaQuery",value:function(e,t){return"@media("+e+"){"+t+"}"}},{key:"_renderCache",value:function(e){var t=this,n="";return e.forEach(function(e,r){var i=t.ids.get(r);e.forEach(function(e,r){var s=t._renderClassName(i,r),a=t._splitPseudoClasses(e);Object.keys(a).forEach(function(e){n+=t._renderSelector(s+e,a[e])})})}),n}}]),e}(),a=function(){function e(){i.classCallCheck(this,e),this.stylesheet=new s}return i.createClass(e,[{key:"render",value:function(e,t,n){return this.stylesheet._renderSelectorVariation(e,t,n)}},{key:"renderToString",value:function(){return this.stylesheet.renderToString()}},{key:"clear",value:function(){this.stylesheet.clear()}}]),e}(),o={Renderer:a};return o});