!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.FelaServer=t()}(this,function(){"use strict";function e(e,t){return t={exports:{}},e(t,t.exports),t.exports}function t(e){var t=0,r=0,n=void 0,i=e.length;if(0===i)return"";for(;i>r;++r)n=e.charCodeAt(r),t=(t<<5)-t+n,t|=0;return"-"+t.toString(36)}function r(e){return Object.keys(e).sort().reduce(function(t,r){return t+r+e[r]},"")}function n(e){return Object.keys(c).reduce(function(t,r){return e.indexOf(r)>-1&&(t=c[r]),t},void 0)}function i(e){return Object.keys(e).forEach(function(t){var r=e[t];r instanceof Object&&!Array.isArray(r)?(e[t]=l(t)||h(t)?i(r):{},0===Object.keys(e[t]).length&&delete e[t]):"string"!=typeof r&&"number"!=typeof r?delete e[t]:"string"==typeof r&&r.indexOf("undefined")>-1&&delete e[t]}),e}function s(e){var t=e.plugins,r=e.style;return t.forEach(function(t){return r=t(e)}),r}function o(e){return Object.keys(e).reduce(function(t,r){return t.length>0&&(t+=";"),t+=y(r)+":"+e[r]},"")}function u(e,t){var r=arguments.length<=2||void 0===arguments[2]?[""]:arguments[2],n=Object.keys(e).reduce(function(t,r){return t+r+"{"+o(i(e[r]))+"}"},"");return r.reduce(function(e,r){return e+"@"+r+"keyframes "+t+"{"+n+"}"},"")}function a(e){return new p(e)}var f={};f["typeof"]="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},f.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},f.createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),f["extends"]=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var c={".woff":"woff",".eof":"eof",".ttf":"truetype",".svg":"svg"},h=function(e){return"@media"===e.substr(0,6)},l=function(e){return":"===e.charAt(0)},d=e(function(e){function t(e){return e.replace(r,"-$&").toLowerCase().replace(n,"-ms-")}var r=/[A-Z]/g,n=/^ms-/;e.exports=t}),y=d&&"object"==typeof d&&"default"in d?d["default"]:d,p=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];f.classCallCheck(this,e),this.listeners=[],this.keyframePrefixes=t.keyframePrefixes||["-webkit-","-moz-"],this.keyframePrefixes.push(""),this.plugins=t.plugins||[],this.clear()}return f.createClass(e,[{key:"clear",value:function(){this.fontFaces="",this.keyframes="",this.statics="",this.rules="",this.mediaRules={},this.rendered={},this.base={},this.ids=[],this._emitChange()}},{key:"renderRule",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];this.ids.indexOf(e)<0&&(this.ids.push(e),this.renderRule(e,{}));var r=this.ids.indexOf(e),n="c"+r+this._generatePropsReference(t);if(!this.rendered.hasOwnProperty(n)){var o={plugins:this.plugins,processStyle:s,style:e(t),props:t},u=i(s(o));this._renderStyle(n,u,this.base[r]),this.rendered[n]=this._didChange,this._didChange&&(this._didChange=!1,this._emitChange()),n==="c"+r&&(this.base[r]=u)}var a="c"+r;return this.rendered[n]?n!==a?a+" "+n:n:a}},{key:"renderKeyframe",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];this.ids.indexOf(e)<0&&this.ids.push(e);var r=this._generatePropsReference(t),n="k"+this.ids.indexOf(e)+r;if(!this.rendered.hasOwnProperty(n)){var i={plugins:this.plugins,processStyle:s,style:e(t),props:t},o=s(i),a=u(o,n,this.keyframePrefixes);this.rendered[n]=!0,this.keyframes+=a,this._emitChange()}return n}},{key:"renderFont",value:function(e,t){var r=this,i=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return this.rendered.hasOwnProperty(e)||!function(){var s={fontFamily:"'"+e+"'",src:t.map(function(e){return"url('"+e+"') format('"+n(e)+"')"}).join(",")},u=["fontVariant","fontWeight","fontStretch","fontStyle","unicodeRange"];Object.keys(i).filter(function(e){return u.indexOf(e)>-1}).forEach(function(e){return s[e]=i[e]});var a="@font-face{"+o(s)+"}";r.rendered[e]=!0,r.fontFaces+=a,r._emitChange()}(),e}},{key:"renderStatic",value:function(e,t){var r="string"==typeof e?e:t;if(!this.rendered.hasOwnProperty(r)){if("string"==typeof e)this.statics+=e.replace(/\s{2,}/g,"");else{var n={plugins:this.plugins,processStyle:s,style:e};this.statics+=t+"{"+o(s(n))+"}"}this.rendered[r]=!0,this._emitChange()}}},{key:"renderToString",value:function(){var e=this.fontFaces+this.statics+this.rules;for(var t in this.mediaRules)e+="@media "+t+"{"+this.mediaRules[t]+"}";return e+this.keyframes}},{key:"subscribe",value:function(e){var t=this;return this.listeners.push(e),{unsubscribe:function(){return t.listeners.splice(t.listeners.indexOf(e),1)}}}},{key:"_emitChange",value:function(){var e=this.renderToString();this.listeners.forEach(function(t){return t(e)})}},{key:"_generatePropsReference",value:function(e){return t(r(e))}},{key:"_renderStyle",value:function(e,t){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],n=this,i=arguments.length<=3||void 0===arguments[3]?"":arguments[3],s=arguments.length<=4||void 0===arguments[4]?"":arguments[4],u=Object.keys(t).reduce(function(o,u){var a=t[u];if(a instanceof Object&&!Array.isArray(a)){if(l(u))n._renderStyle(e,a,r[u],i+u,s);else if(h(u)){var f=u.slice(6).trim(),c=s.length>0?s+" and "+f:f;n._renderStyle(e,a,r[u],i,c)}}else r.hasOwnProperty(u)&&r[u]===a||(o[u]=a);return o},{});if(Object.keys(u).length>0){var a="."+e+i+"{"+o(u)+"}";this._didChange=!0,s.length>0?(this.mediaRules.hasOwnProperty(s)||(this.mediaRules[s]=""),this.mediaRules[s]+=a):this.rules+=a}}}]),e}(),v={createRenderer:a};return v});